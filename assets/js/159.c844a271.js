(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{661:function(s,n,a){"use strict";a.r(n);var t=a(21),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("blockquote",[a("p",[s._v("字符串（String）、列表（list）、字典（hash）、集合（set）、有序集合（sortSet）.")])]),s._v(" "),a("h2",{attrs:{id:"字符串"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#字符串"}},[s._v("#")]),s._v(" 字符串")]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/*\n- 保存字符串对象的结构\n*/\nstruct sdshdr {\n\n   // buf 中已占用空间的长度\n   int len;\n\n   // buf 中剩余可用空间的长度\n   int free;\n\n   // 数据空间\n   char buf[];\n};\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("sds与c字符串的区别")])]),s._v(" "),a("ul",[a("li",[s._v("sds获取字符串长度的复杂度为O(1),c的是O(n)")]),s._v(" "),a("li",[s._v("c的api是不安全的，可能造成缓冲区溢出，sds的是安全的。")]),s._v(" "),a("li",[s._v("修改N次字符串，c需要N次内存分配。sds最多需要N次分配。sds有空间预分配和惰性回收。")]),s._v(" "),a("li",[s._v("sds可以使用部分c的字符串库。")])]),s._v(" "),a("h2",{attrs:{id:"链表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#链表"}},[s._v("#")]),s._v(" 链表")]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/*\n* 双端链表节点\n*/\ntypedef struct listNode {\n\n  // 前置节点\n  struct listNode *prev;\n\n  // 后置节点\n  struct listNode *next;\n\n  // 节点的值\n  void *value;\n\n} listNode;\n\n/*\n* 双端链表结构\n*/\ntypedef struct list {\n\n  // 表头节点\n  listNode *head;\n\n  // 表尾节点\n  listNode *tail;\n\n  // 节点值复制函数\n  void *(*dup)(void *ptr);\n\n  // 节点值释放函数\n  void (*free)(void *ptr);\n\n  // 节点值对比函数\n  int (*match)(void *ptr, void *key);\n\n  // 链表所包含的节点数量\n  unsigned long len;\n\n} list;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("p",[s._v("[外链图片转存中...(img-ua4uHhOc-1653145947289)]")]),s._v(" "),a("h2",{attrs:{id:"hash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hash"}},[s._v("#")]),s._v(" hash")]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/*\n* 哈希表节点\n*/\ntypedef struct dictEntry {\n  \n  // 键\n  void *key;\n\n  // 值\n  union {\n      void *val;\n      uint64_t u64;\n      int64_t s64;\n  } v;\n\n  // 指向下个哈希表节点，形成链表\n  struct dictEntry *next;\n\n} dictEntry;\n\n/*\n* 哈希表\n*\n* 每个字典都使用两个哈希表，从而实现渐进式 rehash 。\n*/\ntypedef struct dictht {\n  \n  // 哈希表数组\n  dictEntry **table;\n\n  // 哈希表大小\n  unsigned long size;\n  \n  // 哈希表大小掩码，用于计算索引值\n  // 总是等于 size - 1\n  unsigned long sizemask;\n\n  // 该哈希表已有节点的数量\n  unsigned long used;\n\n} dictht;\n\n/*\n* 字典\n*/\ntypedef struct dict {\n\n  // 类型特定函数\n  dictType *type;\n\n  // 私有数据\n  void *privdata;\n\n  // 哈希表\n  dictht ht[2];\n\n  // rehash 索引\n  // 当 rehash 不在进行时，值为 -1\n  int rehashidx; /* rehashing not in progress if rehashidx == -1 */\n\n  // 目前正在运行的安全迭代器的数量\n  int iterators; /* number of iterators currently running */\n\n} dict;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br")])]),a("p",[s._v("[外链图片转存中...(img-3IEt2xy5-1653145947290)]\n2.  reHash")]),s._v(" "),a("blockquote",[a("p",[s._v("扩容场景：\n有BGSAVE或者BGREWRITEAOF时，负载因子超过5.\n无BGSAVE或者BGREWRITEAOF时，负载因子超过1.\n扩容为第一个大于等于ht[0].used*2的2的幂")])]),s._v(" "),a("blockquote",[a("p",[s._v("缩容场景：\n负载因子小于0.1\n缩容为第一个大于等于ht[0].used的2的幂")])]),s._v(" "),a("blockquote",[a("p",[s._v("负载因子：ht[0].used/ht[0].size")])]),s._v(" "),a("blockquote",[a("p",[s._v("渐进式rehash:\nrehashidx指向正在hash的索引。rehashidx=-1表示未进行rehash\n每次访问dict结构时rehash一个索引")])]),s._v(" "),a("p",[s._v("[外链图片转存中...(img-A0e54HI9-1653145947290)]")]),s._v(" "),a("h2",{attrs:{id:"跳跃表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跳跃表"}},[s._v("#")]),s._v(" 跳跃表")]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/*\n* 跳跃表节点\n*/\ntypedef struct zskiplistNode {\n\n   // 成员对象\n   robj *obj;\n\n   // 分值\n   double score;\n\n   // 后退指针\n   struct zskiplistNode *backward;\n\n   // 层\n   struct zskiplistLevel {\n\n       // 前进指针\n       struct zskiplistNode *forward;\n\n       // 跨度\n       unsigned int span;\n\n   } level[];\n\n} zskiplistNode;\n\n/*\n* 跳跃表\n*/\ntypedef struct zskiplist {\n\n   // 表头节点和表尾节点\n   struct zskiplistNode *header, *tail;\n\n   // 表中节点的数量\n   unsigned long length;\n\n   // 表中层数最大的节点的层数\n   int level;\n\n} zskiplist;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[s._v("[外链图片转存中...(img-MbZS62dp-1653145947291)]")]),s._v(" "),a("h2",{attrs:{id:"整数集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整数集合"}},[s._v("#")]),s._v(" 整数集合")]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("typedef struct intset {\n   \n   // 编码方式\n   uint32_t encoding;\n\n   // 集合包含的元素数量\n   uint32_t length;\n\n   // 保存元素的数组\n   int8_t contents[];\n\n} intset;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("[外链图片转存中...(img-hdTbZZhS-1653145947291)]\n2. 编码升级\n添加一个元素可能导致编码升级。编码升级需要做三件事")]),s._v(" "),a("ul",[a("li",[s._v("扩展空间")]),s._v(" "),a("li",[s._v("转变现有元素的类型并发至在合适的位置上。保证原有顺序防止")]),s._v(" "),a("li",[s._v("防止新加入的元素。新加入的元素一定是最大或最小的，所以放在最前或者最后")])]),s._v(" "),a("p",[s._v("[外链图片转存中...(img-0R00I0BO-1653145947291)]")]),s._v(" "),a("h2",{attrs:{id:"压缩列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压缩列表"}},[s._v("#")]),s._v(" 压缩列表")]),s._v(" "),a("blockquote",[a("p",[s._v("压缩列表是 Redis 为了节约内存而开发的， 由一系列特殊编码的连续内存块组成的顺序型（sequential）数据结构。\n一个压缩列表可以包含任意多个节点（entry）， 每个节点可以保存一个字节数组或者一个整数值")])]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/*\n* 保存 ziplist 节点信息的结构\n*/\ntypedef struct zlentry {\n\n   // prevrawlen ：前置节点的长度\n   // prevrawlensize ：编码 prevrawlen 所需的字节大小\n   unsigned int prevrawlensize, prevrawlen;\n\n   // len ：当前节点值的长度\n   // lensize ：编码 len 所需的字节大小\n   unsigned int lensize, len;\n\n   // 当前节点 header 的大小\n   // 等于 prevrawlensize + lensize\n   unsigned int headersize;\n\n   // 当前节点值所使用的编码类型\n   unsigned char encoding;\n\n   // 指向当前节点的指针\n   unsigned char *p;\n\n} zlentry;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("示意图\n[外链图片转存中...(img-NMDF8Bnt-1653145947292)]\n[外链图片转存中...(img-5KdqaS0e-1653145947292)]")])]),s._v(" "),a("h2",{attrs:{id:"redisobject"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#redisobject"}},[s._v("#")]),s._v(" RedisObject")]),s._v(" "),a("blockquote",[a("p",[s._v("Redis 使用对象来表示数据库中的键和值， 每次当我们在 Redis 的数据库中新创建一个键值对时， 我们至少会创建两个对象， 一个对象用作键值对的键（键对象）， 另一个对象用作键值对的值（值对象）。")])]),s._v(" "),a("ol",[a("li",[s._v("源码")])]),s._v(" "),a("div",{staticClass:"language-c++ line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("typedef struct redisObject {\n\n   // 类型\n   unsigned type:4;\n\n   // 编码\n   unsigned encoding:4;\n\n   // 对象最后一次被访问的时间\n   unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */\n\n   // 引用计数\n   int refcount;\n\n   // 指向实际值的指针\n   void *ptr;\n\n} robj;\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br")])]),a("p",[s._v("[外链图片转存中...(img-uT4NW4Ki-1653145947292)]\n2. 类型和编码的对应关系\n[外链图片转存中...(img-jkooRnC4-1653145947293)]\n3. 字符串对象")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("值")]),s._v(" "),a("th",[s._v("编码")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("可以用long保存的整形")]),s._v(" "),a("td",[s._v("int")])]),s._v(" "),a("tr",[a("td",[s._v("可以用long，double保存的浮点")]),s._v(" "),a("td",[s._v("embstr或row")])]),s._v(" "),a("tr",[a("td",[s._v("长度太长，不可以用long，double保存的浮点")]),s._v(" "),a("td",[s._v("embstr或row")])]),s._v(" "),a("tr",[a("td",[s._v("小于39字节的字符串")]),s._v(" "),a("td",[s._v("embstr")])]),s._v(" "),a("tr",[a("td",[s._v("大于39字节的字符串")]),s._v(" "),a("td",[s._v("row")])])])]),s._v(" "),a("blockquote",[a("p",[s._v("row要两次申请内存，两次释放内存。为这俩对象RedisObject、SdsStr。embstr申请一次释放一次，而且申请的是连续的内存空间，能更好的利用缓存。")])]),s._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[s._v("链表对象")])]),s._v(" "),a("blockquote",[a("p",[s._v("inkedList和zipList的转换临界值:每个元素长度都小于64、元素个数小于512。满足以上两个条件才能用zipList")])]),s._v(" "),a("ol",{attrs:{start:"5"}},[a("li",[s._v("hash对象")])]),s._v(" "),a("blockquote",[a("p",[s._v("hashtable和zipList的转换临界值:每个元素长度都小于64、元素个数小于512。满足以上两个条件才能用zipList")])]),s._v(" "),a("ol",{attrs:{start:"6"}},[a("li",[s._v("集合对象")])]),s._v(" "),a("blockquote",[a("p",[s._v("hashtable和intset的转换临界值:每个元素都是int、元素个数小于512。满足以上两个条件才能用intset")])]),s._v(" "),a("ol",{attrs:{start:"7"}},[a("li",[s._v("内存回收")])]),s._v(" "),a("blockquote",[a("p",[s._v("redis是用C实现的，C没有自动回收内存的机制。RedisObject中的refCount记录对象的引用个数，当refCount=0的时候自动释放内存。")])]),s._v(" "),a("ol",{attrs:{start:"8"}},[a("li",[s._v("对象共享")])]),s._v(" "),a("blockquote",[a("p",[s._v("0- 9999这1w个整数是共享对象。字符串不做共享对象，因为对比匹配太复杂")])])])}),[],!1,null,null,null);n.default=e.exports}}]);