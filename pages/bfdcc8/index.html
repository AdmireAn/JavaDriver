<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Java NIO了解吗？ | JavaDriver</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/JavaDriver/img/JAVADRIVER.png">
    <meta name="description" content="Java学习与总结">
    <meta name="keywords" content="Java相关技术">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/JavaDriver/assets/css/0.styles.0a81f5bc.css" as="style"><link rel="preload" href="/JavaDriver/assets/js/app.90939cb0.js" as="script"><link rel="preload" href="/JavaDriver/assets/js/2.8d23e9e5.js" as="script"><link rel="preload" href="/JavaDriver/assets/js/179.c08c74c3.js" as="script"><link rel="prefetch" href="/JavaDriver/assets/js/10.1edb6dac.js"><link rel="prefetch" href="/JavaDriver/assets/js/100.b33f86ba.js"><link rel="prefetch" href="/JavaDriver/assets/js/101.0a94513e.js"><link rel="prefetch" href="/JavaDriver/assets/js/102.33e6a080.js"><link rel="prefetch" href="/JavaDriver/assets/js/103.232a13ca.js"><link rel="prefetch" href="/JavaDriver/assets/js/104.7ee6ced0.js"><link rel="prefetch" href="/JavaDriver/assets/js/105.7da3ff13.js"><link rel="prefetch" href="/JavaDriver/assets/js/106.4f67fbe0.js"><link rel="prefetch" href="/JavaDriver/assets/js/107.83ad896a.js"><link rel="prefetch" href="/JavaDriver/assets/js/108.acd73b33.js"><link rel="prefetch" href="/JavaDriver/assets/js/109.0c5a316f.js"><link rel="prefetch" href="/JavaDriver/assets/js/11.06baedfc.js"><link rel="prefetch" href="/JavaDriver/assets/js/110.468674e0.js"><link rel="prefetch" href="/JavaDriver/assets/js/111.0884b25d.js"><link rel="prefetch" href="/JavaDriver/assets/js/112.14a4db1b.js"><link rel="prefetch" href="/JavaDriver/assets/js/113.3665d791.js"><link rel="prefetch" href="/JavaDriver/assets/js/114.a76daf3e.js"><link rel="prefetch" href="/JavaDriver/assets/js/115.fc50325c.js"><link rel="prefetch" href="/JavaDriver/assets/js/116.d878d354.js"><link rel="prefetch" href="/JavaDriver/assets/js/117.41111223.js"><link rel="prefetch" href="/JavaDriver/assets/js/118.2e33528d.js"><link rel="prefetch" href="/JavaDriver/assets/js/119.1c5c3ccd.js"><link rel="prefetch" href="/JavaDriver/assets/js/12.f630918a.js"><link rel="prefetch" href="/JavaDriver/assets/js/120.cf624d25.js"><link rel="prefetch" href="/JavaDriver/assets/js/121.dc9a84ed.js"><link rel="prefetch" href="/JavaDriver/assets/js/122.8cefab56.js"><link rel="prefetch" href="/JavaDriver/assets/js/123.93d23262.js"><link rel="prefetch" href="/JavaDriver/assets/js/124.1df41ca4.js"><link rel="prefetch" href="/JavaDriver/assets/js/125.a7953d41.js"><link rel="prefetch" href="/JavaDriver/assets/js/126.60e10f35.js"><link rel="prefetch" href="/JavaDriver/assets/js/127.dd1cb7a8.js"><link rel="prefetch" href="/JavaDriver/assets/js/128.243a5468.js"><link rel="prefetch" href="/JavaDriver/assets/js/129.5218fc77.js"><link rel="prefetch" href="/JavaDriver/assets/js/13.a35107d5.js"><link rel="prefetch" href="/JavaDriver/assets/js/130.337ce8b9.js"><link rel="prefetch" href="/JavaDriver/assets/js/131.3ede4d10.js"><link rel="prefetch" href="/JavaDriver/assets/js/132.a0f7bf5f.js"><link rel="prefetch" href="/JavaDriver/assets/js/133.2b7b4e83.js"><link rel="prefetch" href="/JavaDriver/assets/js/134.22676154.js"><link rel="prefetch" href="/JavaDriver/assets/js/135.bd2ef845.js"><link rel="prefetch" href="/JavaDriver/assets/js/136.9ee85e23.js"><link rel="prefetch" href="/JavaDriver/assets/js/137.f4f86f41.js"><link rel="prefetch" href="/JavaDriver/assets/js/138.6ebed0f8.js"><link rel="prefetch" href="/JavaDriver/assets/js/139.d65c870e.js"><link rel="prefetch" href="/JavaDriver/assets/js/14.4ee86474.js"><link rel="prefetch" href="/JavaDriver/assets/js/140.6c013524.js"><link rel="prefetch" href="/JavaDriver/assets/js/141.6bb0f0b2.js"><link rel="prefetch" href="/JavaDriver/assets/js/142.0dd7ee63.js"><link rel="prefetch" href="/JavaDriver/assets/js/143.1744f01b.js"><link rel="prefetch" href="/JavaDriver/assets/js/144.3e7af70b.js"><link rel="prefetch" href="/JavaDriver/assets/js/145.26c5f49a.js"><link rel="prefetch" href="/JavaDriver/assets/js/146.a843c882.js"><link rel="prefetch" href="/JavaDriver/assets/js/147.b9986ee3.js"><link rel="prefetch" href="/JavaDriver/assets/js/148.e233f6ad.js"><link rel="prefetch" href="/JavaDriver/assets/js/149.786ca846.js"><link rel="prefetch" href="/JavaDriver/assets/js/15.92d29b5e.js"><link rel="prefetch" href="/JavaDriver/assets/js/150.6b361d6c.js"><link rel="prefetch" href="/JavaDriver/assets/js/151.0c087956.js"><link rel="prefetch" href="/JavaDriver/assets/js/152.12e13429.js"><link rel="prefetch" href="/JavaDriver/assets/js/153.b75da292.js"><link rel="prefetch" href="/JavaDriver/assets/js/154.b47ad622.js"><link rel="prefetch" href="/JavaDriver/assets/js/155.8515b2fc.js"><link rel="prefetch" href="/JavaDriver/assets/js/156.7e86e112.js"><link rel="prefetch" href="/JavaDriver/assets/js/157.eb25995c.js"><link rel="prefetch" href="/JavaDriver/assets/js/158.460bdca5.js"><link rel="prefetch" href="/JavaDriver/assets/js/159.c844a271.js"><link rel="prefetch" href="/JavaDriver/assets/js/16.98bffc3b.js"><link rel="prefetch" href="/JavaDriver/assets/js/160.d3ef9371.js"><link rel="prefetch" href="/JavaDriver/assets/js/161.652a1055.js"><link rel="prefetch" href="/JavaDriver/assets/js/162.418b94d8.js"><link rel="prefetch" href="/JavaDriver/assets/js/163.bb566a17.js"><link rel="prefetch" href="/JavaDriver/assets/js/164.6b2ebfa9.js"><link rel="prefetch" href="/JavaDriver/assets/js/165.95392c30.js"><link rel="prefetch" href="/JavaDriver/assets/js/166.144c9c87.js"><link rel="prefetch" href="/JavaDriver/assets/js/167.058b2c31.js"><link rel="prefetch" href="/JavaDriver/assets/js/168.beb41dd9.js"><link rel="prefetch" href="/JavaDriver/assets/js/169.52df9915.js"><link rel="prefetch" href="/JavaDriver/assets/js/17.a8538471.js"><link rel="prefetch" href="/JavaDriver/assets/js/170.c34bbc93.js"><link rel="prefetch" href="/JavaDriver/assets/js/171.b2363da5.js"><link rel="prefetch" href="/JavaDriver/assets/js/172.2b2f8c5a.js"><link rel="prefetch" href="/JavaDriver/assets/js/173.da36aaa4.js"><link rel="prefetch" href="/JavaDriver/assets/js/174.71264f30.js"><link rel="prefetch" href="/JavaDriver/assets/js/175.611e943b.js"><link rel="prefetch" href="/JavaDriver/assets/js/176.7cfb044f.js"><link rel="prefetch" href="/JavaDriver/assets/js/177.15beef70.js"><link rel="prefetch" href="/JavaDriver/assets/js/178.79ff820c.js"><link rel="prefetch" href="/JavaDriver/assets/js/18.080f06c4.js"><link rel="prefetch" href="/JavaDriver/assets/js/180.681ee059.js"><link rel="prefetch" href="/JavaDriver/assets/js/181.7102e101.js"><link rel="prefetch" href="/JavaDriver/assets/js/182.72203307.js"><link rel="prefetch" href="/JavaDriver/assets/js/183.e1fc959d.js"><link rel="prefetch" href="/JavaDriver/assets/js/184.65792811.js"><link rel="prefetch" href="/JavaDriver/assets/js/185.892e87d5.js"><link rel="prefetch" href="/JavaDriver/assets/js/186.b6b36b6b.js"><link rel="prefetch" href="/JavaDriver/assets/js/187.912699b1.js"><link rel="prefetch" href="/JavaDriver/assets/js/188.42fde07d.js"><link rel="prefetch" href="/JavaDriver/assets/js/189.6c294030.js"><link rel="prefetch" href="/JavaDriver/assets/js/19.3d0b2033.js"><link rel="prefetch" href="/JavaDriver/assets/js/190.b7427722.js"><link rel="prefetch" href="/JavaDriver/assets/js/191.0905ec2f.js"><link rel="prefetch" href="/JavaDriver/assets/js/192.d25b1912.js"><link rel="prefetch" href="/JavaDriver/assets/js/193.308f070f.js"><link rel="prefetch" href="/JavaDriver/assets/js/194.0aec45c8.js"><link rel="prefetch" href="/JavaDriver/assets/js/195.7b67c639.js"><link rel="prefetch" href="/JavaDriver/assets/js/196.38b72bcd.js"><link rel="prefetch" href="/JavaDriver/assets/js/197.42b37542.js"><link rel="prefetch" href="/JavaDriver/assets/js/198.5a0a06dd.js"><link rel="prefetch" href="/JavaDriver/assets/js/199.8d196f68.js"><link rel="prefetch" href="/JavaDriver/assets/js/20.561a0ed2.js"><link rel="prefetch" href="/JavaDriver/assets/js/200.019c8e76.js"><link rel="prefetch" href="/JavaDriver/assets/js/201.fd9e7b3e.js"><link rel="prefetch" href="/JavaDriver/assets/js/202.93342e23.js"><link rel="prefetch" href="/JavaDriver/assets/js/203.6a28f1ac.js"><link rel="prefetch" href="/JavaDriver/assets/js/204.6eaf6ea1.js"><link rel="prefetch" href="/JavaDriver/assets/js/205.abb6e9b0.js"><link rel="prefetch" href="/JavaDriver/assets/js/206.cd876280.js"><link rel="prefetch" href="/JavaDriver/assets/js/207.1c3edc66.js"><link rel="prefetch" href="/JavaDriver/assets/js/208.9d9a37b6.js"><link rel="prefetch" href="/JavaDriver/assets/js/209.45060ee6.js"><link rel="prefetch" href="/JavaDriver/assets/js/21.420dd843.js"><link rel="prefetch" href="/JavaDriver/assets/js/210.8ba5ce75.js"><link rel="prefetch" href="/JavaDriver/assets/js/211.aec9815a.js"><link rel="prefetch" href="/JavaDriver/assets/js/212.375fc6cb.js"><link rel="prefetch" href="/JavaDriver/assets/js/213.991a0661.js"><link rel="prefetch" href="/JavaDriver/assets/js/22.98b908ab.js"><link rel="prefetch" href="/JavaDriver/assets/js/23.84d6cab1.js"><link rel="prefetch" href="/JavaDriver/assets/js/24.dbf6b50f.js"><link rel="prefetch" href="/JavaDriver/assets/js/25.4d483080.js"><link rel="prefetch" href="/JavaDriver/assets/js/26.c686e987.js"><link rel="prefetch" href="/JavaDriver/assets/js/27.9de53bd3.js"><link rel="prefetch" href="/JavaDriver/assets/js/28.9ba021c1.js"><link rel="prefetch" href="/JavaDriver/assets/js/29.f569f48b.js"><link rel="prefetch" href="/JavaDriver/assets/js/3.ac8e7f2b.js"><link rel="prefetch" href="/JavaDriver/assets/js/30.572c0ea8.js"><link rel="prefetch" href="/JavaDriver/assets/js/31.56979919.js"><link rel="prefetch" href="/JavaDriver/assets/js/32.abc7cf1b.js"><link rel="prefetch" href="/JavaDriver/assets/js/33.c8320ed6.js"><link rel="prefetch" href="/JavaDriver/assets/js/34.52928a22.js"><link rel="prefetch" href="/JavaDriver/assets/js/35.e6a425be.js"><link rel="prefetch" href="/JavaDriver/assets/js/36.7e6e2485.js"><link rel="prefetch" href="/JavaDriver/assets/js/37.edf87a13.js"><link rel="prefetch" href="/JavaDriver/assets/js/38.c47c2369.js"><link rel="prefetch" href="/JavaDriver/assets/js/39.9aaceb5c.js"><link rel="prefetch" href="/JavaDriver/assets/js/4.1be738b1.js"><link rel="prefetch" href="/JavaDriver/assets/js/40.276a8da4.js"><link rel="prefetch" href="/JavaDriver/assets/js/41.a14cbeea.js"><link rel="prefetch" href="/JavaDriver/assets/js/42.865930a2.js"><link rel="prefetch" href="/JavaDriver/assets/js/43.285c2f43.js"><link rel="prefetch" href="/JavaDriver/assets/js/44.cc6f4789.js"><link rel="prefetch" href="/JavaDriver/assets/js/45.6e0506e9.js"><link rel="prefetch" href="/JavaDriver/assets/js/46.da5a18f8.js"><link rel="prefetch" href="/JavaDriver/assets/js/47.72808083.js"><link rel="prefetch" href="/JavaDriver/assets/js/48.3344f1f8.js"><link rel="prefetch" href="/JavaDriver/assets/js/49.23c17619.js"><link rel="prefetch" href="/JavaDriver/assets/js/5.a1f24142.js"><link rel="prefetch" href="/JavaDriver/assets/js/50.4230b8a8.js"><link rel="prefetch" href="/JavaDriver/assets/js/51.a6eb687f.js"><link rel="prefetch" href="/JavaDriver/assets/js/52.c4502dea.js"><link rel="prefetch" href="/JavaDriver/assets/js/53.eba15757.js"><link rel="prefetch" href="/JavaDriver/assets/js/54.4b3ecb2b.js"><link rel="prefetch" href="/JavaDriver/assets/js/55.2dfeef15.js"><link rel="prefetch" href="/JavaDriver/assets/js/56.6cf927ae.js"><link rel="prefetch" href="/JavaDriver/assets/js/57.00621ad1.js"><link rel="prefetch" href="/JavaDriver/assets/js/58.4eb2acfb.js"><link rel="prefetch" href="/JavaDriver/assets/js/59.d84c66ff.js"><link rel="prefetch" href="/JavaDriver/assets/js/6.9b4da7fa.js"><link rel="prefetch" href="/JavaDriver/assets/js/60.7de90538.js"><link rel="prefetch" href="/JavaDriver/assets/js/61.8ae7f9c6.js"><link rel="prefetch" href="/JavaDriver/assets/js/62.b9ecfb10.js"><link rel="prefetch" href="/JavaDriver/assets/js/63.46f48322.js"><link rel="prefetch" href="/JavaDriver/assets/js/64.b26606de.js"><link rel="prefetch" href="/JavaDriver/assets/js/65.4d7824c8.js"><link rel="prefetch" href="/JavaDriver/assets/js/66.986ba9c4.js"><link rel="prefetch" href="/JavaDriver/assets/js/67.958eb003.js"><link rel="prefetch" href="/JavaDriver/assets/js/68.a2b5629a.js"><link rel="prefetch" href="/JavaDriver/assets/js/69.1aec44ee.js"><link rel="prefetch" href="/JavaDriver/assets/js/7.d087188e.js"><link rel="prefetch" href="/JavaDriver/assets/js/70.7cd7b4e4.js"><link rel="prefetch" href="/JavaDriver/assets/js/71.c7b8deb0.js"><link rel="prefetch" href="/JavaDriver/assets/js/72.c9db6cf2.js"><link rel="prefetch" href="/JavaDriver/assets/js/73.5746737d.js"><link rel="prefetch" href="/JavaDriver/assets/js/74.bf9a945b.js"><link rel="prefetch" href="/JavaDriver/assets/js/75.04eaebc8.js"><link rel="prefetch" href="/JavaDriver/assets/js/76.8ac15c25.js"><link rel="prefetch" href="/JavaDriver/assets/js/77.a4e297af.js"><link rel="prefetch" href="/JavaDriver/assets/js/78.2d565948.js"><link rel="prefetch" href="/JavaDriver/assets/js/79.cc4189f4.js"><link rel="prefetch" href="/JavaDriver/assets/js/8.c9b8a060.js"><link rel="prefetch" href="/JavaDriver/assets/js/80.b711ac4f.js"><link rel="prefetch" href="/JavaDriver/assets/js/81.102f6e53.js"><link rel="prefetch" href="/JavaDriver/assets/js/82.87bcba98.js"><link rel="prefetch" href="/JavaDriver/assets/js/83.e64e025e.js"><link rel="prefetch" href="/JavaDriver/assets/js/84.a2a3695e.js"><link rel="prefetch" href="/JavaDriver/assets/js/85.a152164e.js"><link rel="prefetch" href="/JavaDriver/assets/js/86.dd920be9.js"><link rel="prefetch" href="/JavaDriver/assets/js/87.7b9fd336.js"><link rel="prefetch" href="/JavaDriver/assets/js/88.b1f3de32.js"><link rel="prefetch" href="/JavaDriver/assets/js/89.584649c5.js"><link rel="prefetch" href="/JavaDriver/assets/js/9.0d1b917b.js"><link rel="prefetch" href="/JavaDriver/assets/js/90.cecafbf6.js"><link rel="prefetch" href="/JavaDriver/assets/js/91.7b4c1cdc.js"><link rel="prefetch" href="/JavaDriver/assets/js/92.9b07fe88.js"><link rel="prefetch" href="/JavaDriver/assets/js/93.221fff07.js"><link rel="prefetch" href="/JavaDriver/assets/js/94.b7ad5ce6.js"><link rel="prefetch" href="/JavaDriver/assets/js/95.9608f6c5.js"><link rel="prefetch" href="/JavaDriver/assets/js/96.659db525.js"><link rel="prefetch" href="/JavaDriver/assets/js/97.2b2d3726.js"><link rel="prefetch" href="/JavaDriver/assets/js/98.5085b009.js"><link rel="prefetch" href="/JavaDriver/assets/js/99.9b605260.js">
    <link rel="stylesheet" href="/JavaDriver/assets/css/0.styles.0a81f5bc.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/JavaDriver/" class="home-link router-link-active"><img src="/JavaDriver/img/JAVADRIVER.png" alt="JavaDriver" class="logo"> <span class="site-name can-hide">JavaDriver</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/JavaDriver/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><a href="/JavaDriver/java/" class="link-title">Java相关</a> <span class="title" style="display:none;">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/a030ff/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/0da4b0/" class="nav-link">并发</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/948850/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/b37ad7/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/JavaDriver/basic/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/e00207/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/e5f2d7/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/a25c3a/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/92288a/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/JavaDriver/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/3a8659/" class="nav-link">MYSQL</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/d70c1f/" class="nav-link">REDIS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/JavaDriver/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/40f3c9/" class="nav-link">Netty</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/561f34/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><a href="/JavaDriver/pages/01b9b2/" class="nav-link">系统设计</a></div><div class="nav-item"><a href="/JavaDriver/pages/5e507a/" class="nav-link">非技术</a></div><div class="nav-item"><a href="/JavaDriver/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/JavaDriver/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/AdmireAn/JavaDriver" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://tva1.sinaimg.cn/large/e6c9d24egy1h2f580pnmdj213w0u0422.jpg"> <div class="blogger-info"><h3>YoungAnn</h3> <span>西二旗Java老司机一枚 致力于社会主义添砖Java</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/JavaDriver/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java相关" class="dropdown-title"><a href="/JavaDriver/java/" class="link-title">Java相关</a> <span class="title" style="display:none;">Java相关</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/a030ff/" class="nav-link">基础</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/0da4b0/" class="nav-link">并发</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/948850/" class="nav-link">JVM</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/b37ad7/" class="nav-link">设计模式</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="计算机基础" class="dropdown-title"><a href="/JavaDriver/basic/" class="link-title">计算机基础</a> <span class="title" style="display:none;">计算机基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/e00207/" class="nav-link">计算机网络</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/e5f2d7/" class="nav-link">操作系统</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/a25c3a/" class="nav-link">数据结构</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/92288a/" class="nav-link">算法</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><a href="/JavaDriver/database/" class="link-title">数据库</a> <span class="title" style="display:none;">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/3a8659/" class="nav-link">MYSQL</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/d70c1f/" class="nav-link">REDIS</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><a href="/JavaDriver/middleware/" class="link-title">中间件</a> <span class="title" style="display:none;">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/40f3c9/" class="nav-link">Netty</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/pages/561f34/" class="nav-link">Kafka</a></li></ul></div></div><div class="nav-item"><a href="/JavaDriver/pages/01b9b2/" class="nav-link">系统设计</a></div><div class="nav-item"><a href="/JavaDriver/pages/5e507a/" class="nav-link">非技术</a></div><div class="nav-item"><a href="/JavaDriver/about/" class="nav-link">关于</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/JavaDriver/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/JavaDriver/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/JavaDriver/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/AdmireAn/JavaDriver" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Netty</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/JavaDriver/pages/40f3c9/" class="sidebar-link">Netty</a></li><li><a href="/JavaDriver/pages/3db019/" class="sidebar-link">TCP粘包拆包问题的解决之道</a></li><li><a href="/JavaDriver/pages/59089d/" class="sidebar-link">Netty中有哪些解码器？</a></li><li><a href="/JavaDriver/pages/ef17ee/" class="sidebar-link">为什么Netty要自己写一个ByteBuf</a></li><li><a href="/JavaDriver/pages/f851b6/" class="sidebar-link">ChannelPipeline和ChannelHandler</a></li><li><a href="/JavaDriver/pages/e7aa60/" class="sidebar-link">EventLoop和EventLoopGroup</a></li><li><a href="/JavaDriver/pages/bfdcc8/" aria-current="page" class="active sidebar-link">Java NIO了解吗？</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_1-1-io概念" class="sidebar-link">1.1 IO概念</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-1-buffer-handler" class="sidebar-link">1.1.1 Buffer Handler</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-1-scatter-gather" class="sidebar-link">1.1.1 scatter/gather</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-2-虚拟内存" class="sidebar-link">1.1.2 虚拟内存</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-3-内存页" class="sidebar-link">1.1.3 内存页</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-4-文件io" class="sidebar-link">1.1.4 文件IO</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_1-1-5-io流" class="sidebar-link">1.1.5 IO流</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_2-1-buffer-basic" class="sidebar-link">2.1 Buffer Basic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-1-buffer的几个属性" class="sidebar-link">2.1.1 Buffer的几个属性</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-2-buffer-api" class="sidebar-link">2.1.2 Buffer API</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-3-访问buffer" class="sidebar-link">2.1.3 访问Buffer</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-4-write" class="sidebar-link">2.1.4 write</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-5-flipping" class="sidebar-link">2.1.5 Flipping</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-6-draining" class="sidebar-link">2.1.6 Draining</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-7-compacting" class="sidebar-link">2.1.7 Compacting</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-9-mark" class="sidebar-link">2.1.9 Mark</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-1-9-comparing" class="sidebar-link">2.1.9 Comparing</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-2-创建buffer" class="sidebar-link">2.2 创建Buffer</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_2-3-duplicating-buffers" class="sidebar-link">2.3 Duplicating Buffers</a></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_2-4-byte-buffers" class="sidebar-link">2.4 Byte Buffers</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-4-1-byte-ordering" class="sidebar-link">2.4.1 Byte Ordering</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-4-2-direct-buffers" class="sidebar-link">2.4.2 Direct Buffers</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-4-3-view-buffers" class="sidebar-link">2.4.3 View Buffers</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_2-4-4-data-element-views" class="sidebar-link">2.4.4 Data Element Views</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-1-basic" class="sidebar-link">3.1 basic</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-1-1-open-channel" class="sidebar-link">3.1.1 Open channel</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-1-2-using-channels" class="sidebar-link">3.1.2 Using Channels</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-1-3-close-channels" class="sidebar-link">3.1.3 close Channels</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-2-scatter-gather" class="sidebar-link">3.2 Scatter/Gather</a></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-3-file-channels" class="sidebar-link">3.3 File Channels</a></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-3-1-accessing-files" class="sidebar-link">3.3.1 Accessing Files</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-3-2-file-locking" class="sidebar-link">3.3.2 File Locking</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-4-memory-mapped-files" class="sidebar-link">3.4 Memory-Mapped Files</a></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_3-5-socket-channels" class="sidebar-link">3.5 Socket Channels</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-5-1-nonblocking-mode" class="sidebar-link">3.5.1 Nonblocking Mode</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-5-2-serversocketchannel" class="sidebar-link">3.5.2 ServerSocketChannel</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-5-4-datagramchannel" class="sidebar-link">3.5.4 DatagramChannel</a></li><li class="sidebar-sub-header level3"><a href="/JavaDriver/pages/bfdcc8/#_3-5-5-pipes" class="sidebar-link">3.5.5 Pipes</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_4-1-基础" class="sidebar-link">4.1 基础</a></li><li class="sidebar-sub-header level2"><a href="/JavaDriver/pages/bfdcc8/#_4-2-示例" class="sidebar-link">4.2 示例</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Kafka</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1baff76c><div class="articleInfo" data-v-1baff76c><ul class="breadcrumbs" data-v-1baff76c><li data-v-1baff76c><a href="/JavaDriver/" title="首页" class="iconfont icon-home router-link-active" data-v-1baff76c></a></li> <li data-v-1baff76c><a href="/JavaDriver/middleware/#中间件" data-v-1baff76c>中间件</a></li><li data-v-1baff76c><a href="/JavaDriver/middleware/#Netty" data-v-1baff76c>Netty</a></li></ul> <div class="info" data-v-1baff76c><div title="作者" class="author iconfont icon-touxiang" data-v-1baff76c><a href="https://github.com/AdmireAn/JavaDriver" target="_blank" title="作者" class="beLink" data-v-1baff76c>YoungAnn</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1baff76c><a href="javascript:;" data-v-1baff76c>2022-05-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABH1JREFUSA3tVl1oHFUUPmdmd2ltklqbpJDiNnXFmgbFktho7YMPNiJSSZM0+CAYSkUELVhM6YuwIPpgoOKDqOBDC0XE2CQoNtQXBUFTTcCi+Wlh1V2TQExsUzcltd3M9Tt3ZjZzZ2fT+OJTL8yeM+eee757fmeJbq//KQL8X3DUSFOcfr7cRsRtxNQMWueeVzOkaITIGqQHNg5y8+jNW9ldM7A6nTpAjuolUikAwq7CE3WcM2RRDz+XGVgN3FptU/aUSlvq9Pa3iZ1+sgAqJyyAFqkipd9dqiwHF3P65YycLWc/6sqGrvoEoIp6DOFaX5h6+dnfjkWprwqsPk0dUGq5vySwDImC10KxFHgGL1SWoc92O3eVht09qdXNH11I2SsTsJYqMWzihqGMi+A+Garf3BAuuLI5oGlULyNfyB/HYNujwktOfRrMr5t77NmevqaUopx0grnKAyvVpmwUDB4x6FPXuGvYLTDwWsejwgtgkYKPqRJg8SV6xaiZ3ZTppGneS4yfH5/66fZSDHv+QZci/+h5c5UHtpy67JUqGppM0sh0Nc1dW6/N1W5Yoqat8/TU/VnadmdeW2PLLSyh0cvxBs3KbqTmwYPpxN4do/mzE8nEpvX/UMu2Wbp74zUAK5q6WkHns7V0eWkdPbPzd3rxkTGybadYySumVzhcaJFbs5UrEkQ/+CK8gF5dnh/6ciIZ73gwQ927L1IitoxKLXYP3SjYdOrHHfTZhRRlFyrorafPk20B3HPD1y2G3qKZME5Jcf3t/HUC13/8tSd++vqFveMUTwAUxSUFI1QekR1+bIze3D9MF2aq6cPvG72CgnldWCFqyRw3lwH8ZMerjTD9ElRO7Gv44wNpC90aASqGfVlz/Rx17srQ57/UU26hkhQqUB7dBR71WmzQhHUnblGmVOEw0jhbV1n9OlXUDCIRGaNV5Jp43N516fN7JmnTHdfp7Hgy0luO4aMhtkLL8Bi3bUWYvzh5Mn1dTxrL6QmGuRhGL/TiTTxRoEdTszSaq9GR0NGA3KdkOz3hqSV3MIDhQ5IVX/Ivx3umBti2es2h4eZby7x8br1rkf7Mo90AqC8aQ3sJeNzqFRu+vSANAQe3PL7l0HGOAdwDCeZYvNKeoZp1Qfs6Aipndh86HmFRi0LAnEO47wsqM6cdfjh3jBPUzhZy7nvlUfFsamED1VQt6aISHVymXZ/B2aCtIG8AI8xfobj2d3en1wWVhOeHELKmLQ1s211s88comkv4UCwWyF787mJdYXtNfhKAXVqnKTq8QZvGAGGOfaTo5pGZ/PwbUCr5+DPr/1J92JNHr9aOl/F3iI5+O1nfybsGxoimvZ3ViWSluDITw3P37mypheDIPY0tw7+O/5ApbkYw+zpfaUVu32Pi98+defdUhEpZkRFq0aqyNh9FuL9hpYbEm6iwi0z2REd09ZmyENEbuhjDWzKvZXTqKYaBIr3tt5kuPtQBZFvEUwHt60vfCNu41XsksH9Ij1BMMz1Y0OOunHNShFIP5868g5zeXmuLwL9T4b6Q2+KejgAAAABJRU5ErkJggg==">Java NIO了解吗？<!----></h1>  <div class="theme-vdoing-content content__default"><p>@<a href="%E7%9B%AE%E5%BD%95">TOC</a></p> <h1 id="第一章-io介绍"><a href="#第一章-io介绍" class="header-anchor">#</a> 第一章 IO介绍</h1> <h2 id="_1-1-io概念"><a href="#_1-1-io概念" class="header-anchor">#</a> 1.1 IO概念</h2> <h3 id="_1-1-1-buffer-handler"><a href="#_1-1-1-buffer-handler" class="header-anchor">#</a> 1.1.1 Buffer Handler</h3> <p>内存分为用户空间（User space），内核空间（Kernel space）。
用户空间的数据读写需要通过内存空间传递。
如下图所示，用户需要读数据，则向cpu发送一个读请求，cpu相应这个请求控制disk controller从disk读取数据到内核buffer，然后再把内核buffer的数据推送给用户空间的buffer。
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL3d3My5zaW5haW1nLmNuL2xhcmdlLzAwNnk4bU42bHkxZzY4c3Rpa2dlbWozMG5hMDlzd2dyLmpwZw?x-oss-process=image/format,png" alt="">
为什么要区分用户空间和内核空间呢？
每个进程有独立的内存空间好处在于多个进程的内存分配互不影响。如果多个进程共享一块内存，那么内存分配的时候就得排队。</p> <p>为什么用户空间不能直接从disk读数据呢？</p> <ul><li>硬件控制器只能处理固定大小的数据，用户空间需要的可能是数据块大小异常或者不对齐的数据，内核空间起作到数拆分、重组的作用。</li> <li>硬件设备通常不允许直接操作虚拟内存，即用户空间</li></ul> <p>DMA是什么？
DMA(Direct Memory Access,直接存储器访问)。
在DMA之前通过中断CPU来传输数据。CPU响应中断，控制总线传输数据。
DMA不需要CPU参与数据传输。DMA可以和CPU交互请求控制总线传输数据。</p> <h3 id="_1-1-1-scatter-gather"><a href="#_1-1-1-scatter-gather" class="header-anchor">#</a> 1.1.1 scatter/gather</h3> <p>分散（scatter）从Channel中读取是指在读操作时将读取的数据写入多个buffer中。因此，Channel将从Channel中读取的数据“分散（scatter）”到多个Buffer中。
聚集（gather）写入Channel是指在写操作时将多个buffer的数据写入同一个Channel，因此，Channel 将多个Buffer中的数据“聚集（gather）”后发送到Channel。</p> <p>比如某个协议的消息固定消息头128字节，消息体1024字节，消息尾128字节。我们想要分别处理消息头，消息体，消息尾。
使用scatter示例代码:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>ByteBuffer header = ByteBuffer.allocate(128);
ByteBuffer body   = ByteBuffer.allocate(1024);
ByteBuffer tail   = ByteBuffer.allocate(128);

ByteBuffer[] bufferArray = { header, body,tail };
channel.read(bufferArray);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cDovL3d3MS5zaW5haW1nLmNuL2xhcmdlLzAwNnk4bU42bHkxZzY4dDMzaWZqcWozMHFrMGJ5dGM5LmpwZw?x-oss-process=image/format,png" alt="">
注意buffer首先被插入到数组，然后再将数组作为channel.read() 的输入参数。read()方法按照buffer在数组中的顺序将从channel中读取的数据写入到buffer，当一个buffer被写满后，channel紧接着向另一个buffer中写。
所以。</p> <p>scatter不适合处理动态消息，相反，gather适合处理动态消息。
buffers数组是write()方法的入参，write()方法会按照buffer在数组中的顺序，将数据写入到channel，注意只有position和limit之间的数据才会被写入。因此，如果一个buffer的容量为128byte，但是仅仅包含58byte的数据，那么这58byte的数据将被写入到channel中。因此与Scattering Reads相反，Gathering Writes能较好的处理动态消息。</p> <h3 id="_1-1-2-虚拟内存"><a href="#_1-1-2-虚拟内存" class="header-anchor">#</a> 1.1.2 虚拟内存</h3> <p>虚拟内存是指使用虚拟内存地址代替物理内存地址。</p> <ul><li>会有多个虚拟内存指向同一个物理内存</li> <li>虚拟内存可能会大于物理内存
上面说disk controller不可以直接把数据读到用户空间。虚拟内存可以通过虚拟地址映射内核空间的方式做到这一点。
如下图，内核空间的buffer对用户空间也是可见的。这就是netty零拷贝的原理，这减少了buffer在用户空间和内核空间的拷贝，非常有意义。
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL3d3Mi5zaW5haW1nLmNuL2xhcmdlLzAwNnk4bU42bHkxZzY4dHR4cDg3a2ozMG5nMGJjNDF2LmpwZw?x-oss-process=image/format,png" alt=""></li></ul> <h3 id="_1-1-3-内存页"><a href="#_1-1-3-内存页" class="header-anchor">#</a> 1.1.3 内存页</h3> <p>操作系统将内存按固定字节分页。
内存读取的基本单位是页。</p> <p>MMU(Memory Management Unit):内存管理单元，保存虚拟内存和物理内存的映射关系，处在CPU和内存之间，起到将虚拟内存转换为物理内存的作用。</p> <h3 id="_1-1-4-文件io"><a href="#_1-1-4-文件io" class="header-anchor">#</a> 1.1.4 文件IO</h3> <p>文件系统：文件IO发生在文件系统。文件保存在磁盘，磁盘扇区类似内存分页的概念。内存文件读取通过文件系统间接操作磁盘文件。
文件零拷贝如下图。避免了文件系统内存页和用户内存页之间的拷贝。
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL3d3My5zaW5haW1nLmNuL2xhcmdlLzAwNnk4bU42bHkxZzZiNWM0NWtuemozMHJrMGQ2ZGtuLmpwZw?x-oss-process=image/format,png" alt=""></p> <h3 id="_1-1-5-io流"><a href="#_1-1-5-io流" class="header-anchor">#</a> 1.1.5 IO流</h3> <p>上面说的IO都是面向块的IO。还有面向流的IO。
大多数操作系统支持将流置为非阻塞模式，额外设置一个进程用于检查流上是否有输入，因此流本身是不被阻塞的。
网络IO一般都是流IO。
多路复用：用一个进程管理多个非阻塞IO流的状态。</p> <h1 id="第二章-buffer"><a href="#第二章-buffer" class="header-anchor">#</a> 第二章 Buffer</h1> <p>标准的IO基于字节流和字符流进行操作的，而NIO是基于通道（Channel）和缓冲区（Buffer）进行操作，数据总是从通道读取到缓冲区中，或者从缓冲区写入到通道中。</p> <h2 id="_2-1-buffer-basic"><a href="#_2-1-buffer-basic" class="header-anchor">#</a> 2.1 Buffer Basic</h2> <h3 id="_2-1-1-buffer的几个属性"><a href="#_2-1-1-buffer的几个属性" class="header-anchor">#</a> 2.1.1 Buffer的几个属性</h3> <ul><li>capacity</li> <li>limit</li> <li>position</li> <li>mark
<img src="https://imgconvert.csdnimg.cn/aHR0cDovL3d3MS5zaW5haW1nLmNuL2xhcmdlLzAwNnk4bU42bHkxZzZiNXoyYWFtYmozMG5jMDk0Z25sLmpwZw?x-oss-process=image/format,png" alt=""></li></ul> <h3 id="_2-1-2-buffer-api"><a href="#_2-1-2-buffer-api" class="header-anchor">#</a> 2.1.2 Buffer API</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>package java.nio;
public abstract class Buffer {
public final int capacity()
public final int position()
public final Buffer position (int newPosition) public final int limit()
  }
public final Buffer limit (int newLimit)
public final Buffer mark()
public final Buffer reset()
public final Buffer clear()
public final Buffer flip()
public final Buffer rewind()
public final int remaining()
public final boolean hasRemaining()
public abstract boolean isReadOnly();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="_2-1-3-访问buffer"><a href="#_2-1-3-访问buffer" class="header-anchor">#</a> 2.1.3 访问Buffer</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class ByteBuffer
       extends Buffer implements Comparable
 {
// This is a partial API listing
public abstract byte get();
public abstract byte get (int index);
public abstract ByteBuffer put (byte b);
public abstract ByteBuffer put (int index, byte b);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_2-1-4-write"><a href="#_2-1-4-write" class="header-anchor">#</a> 2.1.4 write</h3> <p>Figure 2-2的buffer经过下面这个代码会变成Figure 2-3的样子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.put((byte)'H').put((byte)'e').put((byte)'l')
.put((byte)'l').put( (byte)'o');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAwN29rZnY4ajMwbDgwOHlnbzMuanBn?x-oss-process=image/format,png" alt="">
也可以按绝对位置写入：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.put(0, (byte)'M').put((byte)'w');
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAwYm52cWhwajMwbGUwOHFxNWguanBn?x-oss-process=image/format,png" alt=""></p> <h3 id="_2-1-5-flipping"><a href="#_2-1-5-flipping" class="header-anchor">#</a> 2.1.5 Flipping</h3> <p>当我们想要写出buffer的内容时，我们需要用position和limit指针指向时机内容的起始位置。类似这样：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.limit(buffer.position()).position(0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这等同于buffer.flip();
调用flip()后2-4会变成2-5
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAwcGFsaDRoajMwbG0wOTQwdjkuanBn?x-oss-process=image/format,png" alt="">
说白了，flip()改变position和limit两个指针。
rewind()只改变position指针，等同于：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.position(0);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_2-1-6-draining"><a href="#_2-1-6-draining" class="header-anchor">#</a> 2.1.6 Draining</h3> <p>hasRemaining()可以判断是否到达limit指针
下面是一个实现，将buffer内容读到一个数组中</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for (int i = 0; buffer.hasRemaining(), i++) {
       myByteArray [i] = buffer.get();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>remaining()会返回position到limit的数量。
将buffer内容读到一个数组中另一种实现方式：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>int count = buffer.remaining();
for (int i = 0; i &lt; count, i++) {
       myByteArray [i] = buffer.get();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_2-1-7-compacting"><a href="#_2-1-7-compacting" class="header-anchor">#</a> 2.1.7 Compacting</h3> <p>当你drain一部分数据想要继续fill数据的时候，你需要把还未drain的数据整体前移。
buffer.compact()；可以完成这个工作。
调用buffer.compact()的效果就是2-6到2-7
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAxZjRnb3hkajMwbGMwOHNhY2suanBn?x-oss-process=image/format,png" alt=""> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAxZmRsNmJoajMwbjIwOG9kaWcuanBn?x-oss-process=image/format,png" alt=""></p> <h3 id="_2-1-9-mark"><a href="#_2-1-9-mark" class="header-anchor">#</a> 2.1.9 Mark</h3> <p>mark()方法会用mark指针指向position的位置。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.position(2).mark().position(4);
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAxajZ6NDV6ajMwbGkwOG9hY3EuanBn?x-oss-process=image/format,png" alt="">
reset()方法会把position指针指向mark的位置。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>buffer.reset();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAxamRtYTN3ajMwa3EwOWFnbzcuanBn?x-oss-process=image/format,png" alt=""></p> <h3 id="_2-1-9-comparing"><a href="#_2-1-9-comparing" class="header-anchor">#</a> 2.1.9 Comparing</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class ByteBuffer
       extends Buffer implements Comparable
  {
  // This is a partial API listing
public boolean equals (Object ob)
public int compareTo (Object ob)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>equals()返回true需要满足三个条件：</p> <ul><li>Buffer包含相同类型的元素</li> <li>两个Buffer的remaining()返回值相同</li> <li>remaining data的序列相同
下面是两个例子：
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnAxcXZnZnNpajMwbWcwejJxZDAuanBn?x-oss-process=image/format,png" alt=""></li></ul> <h3 id="_2-2-创建buffer"><a href="#_2-2-创建buffer" class="header-anchor">#</a> 2.2 创建Buffer</h3> <p>创建新buffer的两种方式：allocation or wrapping</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class CharBuffer
extends Buffer implements CharSequence, Comparable
{
}
// This is a partial API listing
public static CharBuffer allocate (int capacity)
public static CharBuffer wrap (char [] array)
public static CharBuffer wrap (char [] array, int offset, int length)
public final boolean hasArray()
public final char [] array()
public final int arrayOffset()
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>通过allocation创建的buffer是分配一块固定大小的堆内存作为buffer存储空间。
wrapping创建的buffer是创建一个buffer对象指向一个array空间。</p> <h2 id="_2-3-duplicating-buffers"><a href="#_2-3-duplicating-buffers" class="header-anchor">#</a> 2.3 Duplicating Buffers</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class CharBuffer
extends Buffer implements CharSequence, Comparable
   {
}
// This is a partial API listing
public abstract CharBuffer duplicate();
public abstract CharBuffer asReadOnlyBuffer(); 
public abstract CharBuffer slice();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>duplicate()创建一个新的buffer,和原buffer一样。
两个buffer共享数据元素
但是他们有独立的position, limit, and mark
一个buffer更改了数据元素对另一个buffer可见
只读、直接内存这两个属性也可以通过duplicate()继承
举个例子：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CharBuffer buffer = CharBuffer.allocate (8); 
buffer.position (3).limit (6).mark().position (5); 
CharBuffer dupeBuffer = buffer.duplicate(); buffer.clear();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnM0MDV4cWI2ajMwdmkwY2dxOTAuanBn?x-oss-process=image/format,png" alt="">
asReadOnlyBuffer()和duplicate()功能类似，只是asReadOnlyBuffer()返回一个只读的视图。
slice() 返回一个新的buffer视图，不过
new_position = original_position
new_capacity = original_limit - original_position
举个例子来看slice():</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>CharBuffer buffer = CharBuffer.allocate (8); 
buffer.position (3).limit (5);
CharBuffer sliceBuffer = buffer.slice();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnM0NXA2Y2llajMwc28wZW10ZTguanBn?x-oss-process=image/format,png" alt=""></p> <h2 id="_2-4-byte-buffers"><a href="#_2-4-byte-buffers" class="header-anchor">#</a> 2.4 Byte Buffers</h2> <h3 id="_2-4-1-byte-ordering"><a href="#_2-4-1-byte-ordering" class="header-anchor">#</a> 2.4.1 Byte Ordering</h3> <p>原始数据类型在内存中的存储方式是多个字节的连续序列。
举个例子一个32-bit int 值为 0x037FB4C7的内存存储序列可能为2-14也可能为2-15:
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnNnM0aDY2MGozajMwaTQwZWl3Z3MuanBn?x-oss-process=image/format,png" alt="">
这就是所谓的大端设计和小端设计。
采用大端还是小端通常由硬件的设计者决定而不是小端的设计者。
IP协议定义的字节顺序是大端。所有使用IP协议的多字节数值必须在网络字节序和本地主机字节序做转换。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>package java.nio;
public final class ByteOrder
{
public static final ByteOrder BIG_ENDIAN public static final ByteOrder LITTLE_ENDIAN
public static ByteOrder nativeOrder()
public String toString()
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>除了ByteBuffer之外，其他buffer的order()适中返回同一个值，ByteOrder.nativeOrder()。</p> <h3 id="_2-4-2-direct-buffers"><a href="#_2-4-2-direct-buffers" class="header-anchor">#</a> 2.4.2 Direct Buffers</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class ByteBuffer extends Buffer implements Comparable {
// This is a partial API listing
public static ByteBuffer allocate (int capacity) ;
public static ByteBuffer allocateDirect (int capacity) ;
public abstract boolean isDirect();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>allocateDirect可以直接在堆外开辟一个buffer。
堆外buffer节省了用户空间和系统空间的buffer拷贝，提升效率。</p> <h3 id="_2-4-3-view-buffers"><a href="#_2-4-3-view-buffers" class="header-anchor">#</a> 2.4.3 View Buffers</h3> <p>收到数据的时候你可能要先看一下数据再决定做什么操作，这就需要用到ByteBuffer的视图API。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class ByteBuffer extends Buffer implements Comparable {
// This is a partial API listing
public abstract CharBuffer asCharBuffer(); 
public abstract ShortBuffer asShortBuffer(); 
public abstract IntBuffer asIntBuffer();
 public abstract LongBuffer asLongBuffer();
  public abstract FloatBuffer asFloatBuffer();
   public abstract DoubleBuffer asDoubleBuffer();
   }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>视图在直接内存buffer上操作更高效。
当本地硬件的字节顺序和buffer中的字节顺序一致时，通过低级代码就可以操作buffer中的数据，而不需要经过字节码的编码解码。</p> <h3 id="_2-4-4-data-element-views"><a href="#_2-4-4-data-element-views" class="header-anchor">#</a> 2.4.4 Data Element Views</h3> <p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnN2hjZGhzbnFqajMwbWswOHNkaHIuanBn?x-oss-process=image/format,png" alt="">
当getInt() 被调用时，那么从当前位置开始的4个字节将被打包成一个int返回。
int value = buffer.getInt();将返回buffer中的1-4位，具体返回的数据值与字节序有关系。
int value = buffer.order (ByteOrder.BIG_ENDIAN).getInt();
返回0x3BC5315E。
int value = buffer.order (ByteOrder.LITTLE_ENDIAN).getInt();
返回0x5E31C53B。</p> <h1 id="第三章-channels"><a href="#第三章-channels" class="header-anchor">#</a> 第三章 Channels</h1> <h2 id="_3-1-basic"><a href="#_3-1-basic" class="header-anchor">#</a> 3.1 basic</h2> <p>在NIO接口中我们需要使用Channel和Buffer进行IO操作，Channel模拟了流的概念，但是又有不同。数据总是从一个Channel读到一个buffer中，或者从一个buffer中写到channel中。
channel接口的主要实现类如下：</p> <ul><li>FileChannel</li> <li>DatagramChannel</li> <li>SocketChannel</li> <li>ServerSocketChannel</li></ul> <p>JavaNIO Channels和流有一些相似，但是又有些不同：</p> <p>你可以同时读和写Channels，流Stream只支持单向的读或写（InputStream/OutputStream）</p> <ul><li>Channels可以异步的读和写，流Stream是同步的</li> <li>Channels总是读取到buffer或者从buffer中写入</li></ul> <p>下面分别介绍一下Channel最重要的一些实现类：</p> <ul><li>FileChannel : 可以读写文件中的数据</li> <li>DatagramChannel：可以通过UDP协议读写数据</li> <li>SocketChannel：可以通过TCP协议读写数据</li> <li>ServerSocketChannel：允许我们像一个web服务器那样监听TCP链接请求，为每一个链接请求创建一个SocketChannel</li></ul> <h3 id="_3-1-1-open-channel"><a href="#_3-1-1-open-channel" class="header-anchor">#</a> 3.1.1 Open channel</h3> <p>FileChannel只能通过getChannel()得到。
SocketChannel有工厂方法可以得到。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>SocketChannel sc = SocketChannel.open();
sc.connect (new InetSocketAddress (&quot;somehost&quot;, someport));

ServerSocketChannel ssc = ServerSocketChannel.open(); ssc.socket().bind (new InetSocketAddress (somelocalport));
DatagramChannel dc = DatagramChannel.open();

RandomAccessFile raf = new RandomAccessFile (&quot;somefile&quot;, &quot;r&quot;); FileChannel fc = raf.getChannel();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="_3-1-2-using-channels"><a href="#_3-1-2-using-channels" class="header-anchor">#</a> 3.1.2 Using Channels</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>public interface ReadableByteChannel extends Channel {
public int read (ByteBuffer dst) throws IOException;
}

public interface WritableByteChannel extends Channel {
public int write (ByteBuffer src) throws IOException;
 }
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Channels 可以是单向或者双向的。
如果一个class实现了上面两个接口，就是双向的。
Channels可以在阻塞模式和非阻塞模式工作。
只有socket和pipes可以工作在非阻塞模式。</p> <h3 id="_3-1-3-close-channels"><a href="#_3-1-3-close-channels" class="header-anchor">#</a> 3.1.3 close Channels</h3> <h2 id="_3-2-scatter-gather"><a href="#_3-2-scatter-gather" class="header-anchor">#</a> 3.2 Scatter/Gather</h2> <p>Scatter：将多个buffer按照顺序合成一个
Gather：将一个字符串按照顺序拆分成多个。逐个填满buffer。
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnN3RkMXgzOXpxajMweTAwZWc3OGIuanBn?x-oss-process=image/format,png" alt=""> <img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnN3RkMjRvbmtpajMxM3cwZjY3ODkuanBn?x-oss-process=image/format,png" alt=""></p> <h2 id="_3-3-file-channels"><a href="#_3-3-file-channels" class="header-anchor">#</a> 3.3 File Channels</h2> <p>File channels 只能以阻塞模式工作。</p> <h2 id="_3-3-1-accessing-files"><a href="#_3-3-1-accessing-files" class="header-anchor">#</a> 3.3.1 Accessing Files</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class FileChannel extends AbstractChannel 
implements ByteChannel, GatheringByteChannel, ScatteringByteChannel{
// This is a partial API listing
//获取position位置
public abstract long position()
//设置position
public abstract void position (long newPosition)
//从position位置开始读
public abstract int read (ByteBuffer dst)
//从position位置开始读
public abstract int read (ByteBuffer dst, long position)
//从position位置开始写
 public abstract int write (ByteBuffer src)
//从position位置开始写
public abstract int write (ByteBuffer src, long position)
public abstract long size()
//截取文件保留size大小，并移动position到size的位置
public abstract void truncate (long size) 
//强制刷新缓存到磁盘文件
public abstract void force (boolean metaData)
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="_3-3-2-file-locking"><a href="#_3-3-2-file-locking" class="header-anchor">#</a> 3.3.2 File Locking</h3> <h2 id="_3-4-memory-mapped-files"><a href="#_3-4-memory-mapped-files" class="header-anchor">#</a> 3.4 Memory-Mapped Files</h2> <h2 id="_3-5-socket-channels"><a href="#_3-5-socket-channels" class="header-anchor">#</a> 3.5 Socket Channels</h2> <p>The new socket channels can operate in <strong>nonblocking</strong> mode and are <strong>selectable</strong>. These two capabilities enable tremendous scalability and flexibility in large applications.
ServerSocketChannel没有实现read和write接口，说明它不需要转发数据。它只负责家庭socket连接，创建SocketChannel。</p> <p>a channel is a conduit to an I/O service and provides methods for interacting with that service</p> <p>每个socket channels都有一个socket与之对应，调用socket()可以获得。
但并不是所有的sockets都有channels。socket的getChannel()可能但会null;</p> <h3 id="_3-5-1-nonblocking-mode"><a href="#_3-5-1-nonblocking-mode" class="header-anchor">#</a> 3.5.1 Nonblocking Mode</h3> <p>调用configureBlocking (false);设置channel为非阻塞模式。
但是只有持有blockingLock() 返回的对象锁的线程才能修改阻塞模式。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Socket socket = null;
Object lockObj = serverChannel.blockingLock();
// have a handle to the lock object, but haven't locked it yet
// may block here until lock is acquired
synchronize (lockObj){
// This thread now owns the lock; mode can't be changed boolean prevState = serverChannel.isBlocking();
serverChannel.configureBlocking (false); socket = serverChannel.accept(); serverChannel.configureBlocking (prevState);
}
// lock is now released, mode is allowed to change
if (socket != null) {
doSomethingWithTheSocket (socket);
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_3-5-2-serversocketchannel"><a href="#_3-5-2-serversocketchannel" class="header-anchor">#</a> 3.5.2 ServerSocketChannel</h3> <p>The ServerSocketChannel class is a channel-based socket listener.
它负责处理socket任务并添加channel。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class SocketChannel
    extends AbstractSelectableChannel
    implements ByteChannel, ScatteringByteChannel, GatheringByteChannel, NetworkChannel
{
//SocketChannel被创建但是并没有连接，open（）只是创建一个SocketChannel，还需要调用connect()连接到一个地址
public static SocketChannel open() throws IOException
//创建并连接
public static SocketChannel open(SocketAddress remote) throws IOException
//支持的操作（读、写、连接）
public final int validOps()
、、
public abstract Socket socket();
//是否连接到远程
public abstract boolean isConnected();
//Connect（）方法是耗时的，因为需要数据包对话（TCP握手）。如果SocketChannel身上有并发、connect(),isConnectionPending返回true
public abstract boolean isConnectionPending();
//建立连接
public abstract boolean connect(SocketAddress remote) throws IOException;
//任何时候都可以安全的调用
public abstract boolean finishConnect() throws IOException;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>Socket channels是线程安全的。
Socket是面向流的而不是面向数据包的，它能保证到达的顺序是发送的顺序，不能保证维护分组。发送方发送20个字节，接收方read可能直接受到7个字节，其余字节在传输中。所以，多个线程共享一个socket的一端不是好的设计。</p> <h3 id="_3-5-4-datagramchannel"><a href="#_3-5-4-datagramchannel" class="header-anchor">#</a> 3.5.4 DatagramChannel</h3> <p>socketchannel为面向连接的流协议（如tcp/ip）
datagramchannel为面向无连接的数据包协议（如udp/ip）</p> <h3 id="_3-5-5-pipes"><a href="#_3-5-5-pipes" class="header-anchor">#</a> 3.5.5 Pipes</h3> <p>Pipe用于同一个JVM内不同线程之间的数据交换问题
不同JVM之间的数据交换问题应该使用SocketChannel
Pipe类创建了一对channel对象，它们提供了一种回送机制。
Pipe实现两个进程之间的单向数据连接。
Pipe有一个SinkChannel和一个SourceChannel
数据会从SourceChannel读取、被写到SinkChannel
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly90dmExLnNpbmFpbWcuY24vbGFyZ2UvMDA2eThtTjZseTFnOGFwejdtaHZ3ajMwbXMwN3d0YzkuanBn?x-oss-process=image/format,png" alt=""></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>public abstract class Pipe {
    public static abstract class SourceChannel
        extends AbstractSelectableChannel
        implements ReadableByteChannel, ScatteringByteChannel
    {
        protected SourceChannel(SelectorProvider provider) {
            super(provider);
        }
        public final int validOps() {
            return SelectionKey.OP_READ;
        }
    }

    public static abstract class SinkChannel
        extends AbstractSelectableChannel
        implements WritableByteChannel, GatheringByteChannel
    {
        protected SinkChannel(SelectorProvider provider) {
            super(provider);
        }
        public final int validOps() {
            return SelectionKey.OP_WRITE;
        }

    }
    protected Pipe() { }
    //从管道读取数据，要访问source通道
    public abstract SourceChannel source();
    //向管道写入数据，要访问Sink通道
    public abstract SinkChannel sink();
    //管道创建
    public static Pipe open() throws IOException {
        return SelectorProvider.provider().openPipe();
    }
}

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h1 id="第四章-selectors"><a href="#第四章-selectors" class="header-anchor">#</a> 第四章 Selectors</h1> <p>Selector（选择器）是Java NIO中能够检测一到多个NIO通道，并能够知晓通道是否为诸如读写事件做好准备的组件。这样，一个单独的线程可以管理多个channel，从而管理多个网络连接,仅用单个线程来处理多个Channels的好处是，只需要更少的线程来处理通道。</p> <h2 id="_4-1-基础"><a href="#_4-1-基础" class="header-anchor">#</a> 4.1 基础</h2> <ul><li>Selector：一个selector可以注册多个channel，一个线程通过管理Selector实现管理多个channel。</li> <li>SelectableChannel：提供channle selectability的通用方法。</li> <li>SelectionKey：封装了channle和selector的注册关系，包含注册的感兴趣的事件。</li></ul> <h2 id="_4-2-示例"><a href="#_4-2-示例" class="header-anchor">#</a> 4.2 示例</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>//创建Selector
Selector selector = Selector.open();
channel.configureBlocking(false);
//注册Selector
SelectionKey key = channel.register(selector, SelectionKey.OP_READ);
while(true) {
//单线程阻塞检查Selector中就绪的事件
  int readyChannels = selector.select();
  if(readyChannels == 0) continue;
  Set selectedKeys = selector.selectedKeys();
  Iterator keyIterator = selectedKeys.iterator();
  //循环处理就绪的事件
  while(keyIterator.hasNext()) {
    SelectionKey key = keyIterator.next();
    if(key.isAcceptable()) {
        // a connection was accepted by a ServerSocketChannel.
    } else if (key.isConnectable()) {
        // a connection was established with a remote server.
    } else if (key.isReadable()) {
        // a channel is ready for reading
    } else if (key.isWritable()) {
        // a channel is ready for writing
    }
    keyIterator.remove();
  }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/AdmireAn/JavaDriver/edit/master/docs/04.中间件/10.Netty/050.Java NIO了解吗？.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/05/22, 00:01:01</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/JavaDriver/pages/e7aa60/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">EventLoop和EventLoopGroup</div></a> <a href="/JavaDriver/pages/561f34/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Kafka</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/JavaDriver/pages/e7aa60/" class="prev">EventLoop和EventLoopGroup</a></span> <span class="next"><a href="/JavaDriver/pages/561f34/">Kafka</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/JavaDriver/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/JavaDriver/pages/bb7e83/"><div>
            电商-商品系统设计
            <!----></div></a> <span class="date">12-17</span></dt></dl><dl><dd>02</dd> <dt><a href="/JavaDriver/pages/6ac68e/"><div>
            关于如何写OKR
            <!----></div></a> <span class="date">12-09</span></dt></dl><dl><dd>03</dd> <dt><a href="/JavaDriver/pages/74395b/"><div>
            对事不对人 vs 对人不对事
            <!----></div></a> <span class="date">12-09</span></dt></dl> <dl><dd></dd> <dt><a href="/JavaDriver/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:854818303@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/AdmireAn" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://music.163.com/#/playlist?id=755597173" title="听音乐" target="_blank" class="iconfont icon-erji"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>YoungAnnn | <a href="https://github.com/AdmireAn/JavaDriver" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/JavaDriver/assets/js/app.90939cb0.js" defer></script><script src="/JavaDriver/assets/js/2.8d23e9e5.js" defer></script><script src="/JavaDriver/assets/js/179.c08c74c3.js" defer></script>
  </body>
</html>
